<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FROSTDRAGON | Enterprise Schema Drift Detection Engine v5.0</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Space+Mono:wght@400;700&family=JetBrains+Mono:wght@300;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'JetBrains Mono', 'Space Mono', monospace;
            background: #000;
            color: #00ffff;
            overflow-x: hidden;
            min-height: 100vh;
        }
        
        .frost-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 20% 50%, rgba(0, 150, 255, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }
        
        #matrixCanvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 0;
            opacity: 0.5;
        }
        
        .container {
            position: relative;
            z-index: 2;
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .tech-bar {
            display: flex;
            gap: 10px;
            padding: 10px;
            background: rgba(0, 20, 40, 0.9);
            border: 1px solid rgba(0, 255, 255, 0.3);
            font-size: 11px;
            color: rgba(0, 255, 255, 0.7);
            margin-bottom: 20px;
            font-family: 'Space Mono', monospace;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 0;
            border-bottom: 2px solid rgba(0, 255, 255, 0.3);
            margin-bottom: 30px;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 30px;
        }
        
        .logo-container {
            position: relative;
            width: 60px;
            height: 60px;
        }
        
        .geometric-dragon {
            width: 60px;
            height: 60px;
            position: relative;
            background: linear-gradient(135deg, #00ffff 0%, #0066ff 100%);
            clip-path: polygon(
                20% 0%, 80% 0%, 100% 20%, 
                100% 60%, 80% 80%, 60% 100%,
                20% 100%, 0% 80%, 0% 20%
            );
            display: flex;
            align-items: center;
            justify-content: center;
            animation: rotate-3d 4s linear infinite;
        }
        
        @keyframes rotate-3d {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(360deg); }
        }
        
        .dragon-overlay {
            font-size: 24px;
            font-weight: 900;
            color: #000;
            text-shadow: 0 0 10px #00ffff;
            z-index: 2;
        }
        
        .dragon-shape {
            position: absolute;
            inset: 3px;
            background: #000;
            clip-path: inherit;
        }
        
        .mini-logo {
            display: inline-block;
            width: 20px;
            height: 20px;
            line-height: 20px;
            text-align: center;
            background: linear-gradient(135deg, #00ffff 0%, #0066ff 100%);
            color: #000;
            font-weight: bold;
            margin-right: 10px;
            border-radius: 3px;
        }
        
        .main-title {
            font-size: 48px;
            font-weight: 900;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 4px;
            color: transparent;
            background: linear-gradient(90deg, #00ffff, #0099ff, #00ffff);
            -webkit-background-clip: text;
            background-clip: text;
            text-shadow: 0 0 40px rgba(0, 255, 255, 0.5);
            position: relative;
        }
        
        .main-title::before {
            content: attr(data-text);
            position: absolute;
            top: 0;
            left: 0;
            color: rgba(0, 255, 255, 0.1);
            animation: glitch 2s infinite;
        }
        
        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            20% { transform: translate(-2px, 2px); }
            40% { transform: translate(2px, -2px); }
            60% { transform: translate(-2px, -2px); }
            80% { transform: translate(2px, 2px); }
        }
        
        .subtitle {
            font-size: 14px;
            color: rgba(0, 255, 255, 0.8);
            letter-spacing: 2px;
        }
        
        .tech-subtitle {
            font-size: 11px;
            color: rgba(0, 255, 255, 0.5);
            margin-top: 5px;
        }
        
        .metrics-panel {
            display: flex;
            gap: 20px;
        }
        
        .primary-metrics {
            display: flex;
            gap: 20px;
        }
        
        .metric-card {
            background: rgba(0, 20, 40, 0.8);
            border: 1px solid rgba(0, 255, 255, 0.3);
            padding: 20px;
            min-width: 150px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scan 3s linear infinite;
        }
        
        @keyframes scan {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .critical-metric {
            border-color: rgba(255, 0, 100, 0.5);
            background: rgba(50, 0, 20, 0.8);
        }
        
        .critical-metric .metric-value {
            color: #ff3366;
            text-shadow: 0 0 20px rgba(255, 50, 100, 0.8);
        }
        
        .metric-header {
            font-size: 11px;
            color: rgba(0, 255, 255, 0.6);
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .metric-value {
            font-size: 28px;
            font-weight: bold;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .metric-sub {
            font-size: 10px;
            color: rgba(0, 255, 255, 0.4);
            margin-top: 5px;
        }
        
        .impact-grid {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 20, 40, 0.5);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .impact-item {
            text-align: center;
        }
        
        .impact-label {
            display: block;
            font-size: 10px;
            color: rgba(0, 255, 255, 0.5);
            margin-bottom: 5px;
        }
        
        .impact-value {
            font-size: 20px;
            color: #00ffff;
            font-weight: bold;
        }
        
        .cost-breakdown-panel {
            margin: 30px 0;
            background: rgba(0, 10, 30, 0.9);
            border: 2px solid rgba(0, 255, 255, 0.3);
            overflow: hidden;
        }
        
        .breakdown-header {
            padding: 15px;
            background: rgba(0, 50, 100, 0.4);
            font-size: 14px;
            font-weight: bold;
            color: #00ffff;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .breakdown-content {
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .calc-section {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border: 1px solid rgba(0, 255, 255, 0.2);
        }
        
        .calc-section h3 {
            color: #00ffff;
            font-size: 12px;
            margin-bottom: 10px;
            letter-spacing: 1px;
        }
        
        .calc-line {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            font-size: 11px;
            color: rgba(0, 255, 255, 0.8);
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
        }
        
        .calc-line.highlight {
            background: rgba(0, 100, 200, 0.2);
            padding: 8px 5px;
            margin-top: 10px;
            font-weight: bold;
        }
        
        .calc-label {
            color: rgba(0, 255, 255, 0.6);
        }
        
        .calc-value {
            color: #00ffff;
        }
        
        .calc-total {
            grid-column: 1 / -1;
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            margin-top: 10px;
            border: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .total-line {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            font-size: 12px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
        }
        
        .grand-total {
            background: rgba(255, 0, 100, 0.2);
            border: 1px solid rgba(255, 0, 100, 0.5);
            margin-top: 10px;
            font-size: 16px;
            font-weight: bold;
            color: #ff3366;
        }
        
        .drift-main-container {
            background: rgba(0, 10, 30, 0.9);
            border: 2px solid rgba(0, 255, 255, 0.3);
            margin: 30px 0;
            position: relative;
        }
        
        .drift-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(0, 50, 100, 0.2);
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .drift-title {
            font-size: 18px;
            font-weight: bold;
            color: #00ffff;
            display: flex;
            align-items: center;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .ctrl-btn {
            background: rgba(0, 100, 200, 0.2);
            border: 1px solid rgba(0, 255, 255, 0.5);
            color: #00ffff;
            padding: 8px 15px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
            font-family: 'Space Mono', monospace;
        }
        
        .ctrl-btn:hover {
            background: rgba(0, 100, 200, 0.4);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }
        
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #00ff88;
            font-size: 12px;
            font-weight: bold;
        }
        
        .live-pulse {
            width: 10px;
            height: 10px;
            background: #00ff88;
            border-radius: 50%;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 136, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 136, 0); }
        }
        
        .scan-line {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #00ffff, transparent);
            animation: scan-horizontal 2s linear infinite;
        }
        
        @keyframes scan-horizontal {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: rgba(0, 255, 255, 0.5);
        }
        
        .frost-loader {
            width: 50px;
            height: 50px;
            margin: 0 auto 20px;
            border: 3px solid rgba(0, 255, 255, 0.1);
            border-top: 3px solid #00ffff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .drift-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 11px;
        }
        
        .drift-table th {
            background: rgba(0, 50, 100, 0.3);
            padding: 12px;
            text-align: left;
            color: rgba(0, 255, 255, 0.8);
            font-weight: bold;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.3);
        }
        
        .drift-table td {
            padding: 10px 12px;
            border-bottom: 1px solid rgba(0, 255, 255, 0.1);
            color: rgba(0, 255, 255, 0.9);
        }
        
        .drift-row {
            transition: all 0.3s;
        }
        
        .drift-row:hover {
            background: rgba(0, 100, 200, 0.1);
        }
        
        .drift-row.new-entry {
            animation: flash-entry 1s;
        }
        
        @keyframes flash-entry {
            0% { 
                background: rgba(0, 255, 255, 0.3);
                transform: translateX(-100%);
                opacity: 0;
            }
            50% {
                transform: translateX(0);
                opacity: 1;
            }
            100% { 
                background: transparent;
            }
        }
        
        .drift-row[data-severity="CRITICAL"] {
            border-left: 3px solid #ff3366;
        }
        
        .timestamp {
            font-family: 'JetBrains Mono', monospace;
            color: rgba(0, 255, 255, 0.6);
            font-size: 10px;
        }
        
        .table-name {
            color: #00ffff;
            font-weight: bold;
        }
        
        .column-name {
            color: rgba(0, 255, 255, 0.8);
        }
        
        .mutation {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .old-schema, .new-schema {
            background: rgba(0, 50, 100, 0.3);
            padding: 2px 8px;
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 3px;
        }
        
        .new-schema.dropped {
            background: rgba(255, 0, 50, 0.2);
            border-color: rgba(255, 0, 100, 0.5);
            color: #ff3366;
        }
        
        .arrow {
            color: #ff9900;
        }
        
        .severity-badge {
            padding: 3px 10px;
            border-radius: 3px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 10px;
        }
        
        .severity-critical {
            background: rgba(255, 0, 100, 0.3);
            color: #ff3366;
            border: 1px solid #ff3366;
        }
        
        .severity-high {
            background: rgba(255, 150, 0, 0.3);
            color: #ff9900;
            border: 1px solid #ff9900;
        }
        
        .cost {
            color: #ff3366;
            font-weight: bold;
            font-size: 12px;
        }
        
        .technical-footer {
            padding: 10px;
            background: rgba(0, 0, 0, 0.5);
            border-top: 1px solid rgba(0, 255, 255, 0.2);
            font-size: 10px;
            color: rgba(0, 255, 255, 0.5);
            display: flex;
            gap: 10px;
        }
        
        /* TSUNAMI MODE STYLES */
        .tsunami-active .metric-value {
            animation: value-surge 0.5s ease-out;
        }
        
        @keyframes value-surge {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); color: #ff0099; }
            100% { transform: scale(1); }
        }
        
        .drift-cascade {
            position: fixed;
            top: -50px;
            font-size: 14px;
            color: #ff3366;
            font-weight: bold;
            z-index: 999;
            animation: cascade-fall 3s linear;
            pointer-events: none;
            text-shadow: 0 0 10px rgba(255, 50, 100, 0.8);
        }
        
        @keyframes cascade-fall {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="frost-overlay"></div>
    <div class="matrix-bg">
        <canvas id="matrixCanvas"></canvas>
    </div>
    
    <div class="container">
        <!-- TECHNICAL SPEC BAR -->
        <div class="tech-bar">
            <span>FROSTDRAGON v5.0.0</span>
            <span>|</span>
            <span>K8s CLUSTER: ACTIVE</span>
            <span>|</span>
            <span>ENDPOINT: 212.2.243.31</span>
            <span>|</span>
            <span>PROTOCOL: HTTP/1.1</span>
            <span>|</span>
            <span>ENGINE: NODE.JS 18</span>
            <span>|</span>
            <span id="timestamp">--:--:--</span>
        </div>
        
        <header>
            <div class="logo-section">
                <div class="logo-container">
                    <div class="geometric-dragon">
                        <div class="dragon-shape"></div>
                        <div class="dragon-overlay">FD</div>
                    </div>
                </div>
                <div class="title-group">
                    <h1 class="main-title" data-text="FROSTDRAGON">FROSTDRAGON</h1>
                    <div class="subtitle">ENTERPRISE SCHEMA DRIFT DETECTION</div>
                    <div class="tech-subtitle">SNOWFLAKE | BIGQUERY | REDSHIFT | DATABRICKS</div>
                </div>
            </div>
            
            <div class="metrics-panel">
                <div class="primary-metrics">
                    <div class="metric-card critical-metric">
                        <div class="metric-header">TOTAL DAMAGE</div>
                        <div class="metric-value" id="totalCost">$0</div>
                        <div class="metric-sub">VERIFIED COST</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">DRIFT EVENTS</div>
                        <div class="metric-value" id="driftCount">0</div>
                        <div class="metric-sub">SCHEMA MUTATIONS</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">AVG COST/EVENT</div>
                        <div class="metric-value" id="avgCost">$0</div>
                        <div class="metric-sub">IMPACT PER DRIFT</div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- IMPACT DASHBOARD -->
        <div class="impact-grid">
            <div class="impact-item">
                <span class="impact-label">PIPELINES BROKEN</span>
                <span class="impact-value" id="pipelinesBroken">0</span>
            </div>
            <div class="impact-item">
                <span class="impact-label">QUERIES FAILED</span>
                <span class="impact-value" id="queriesFailed">0</span>
            </div>
            <div class="impact-item">
                <span class="impact-label">TABLES AFFECTED</span>
                <span class="impact-value" id="tablesAffected">0</span>
            </div>
            <div class="impact-item">
                <span class="impact-label">COMPUTE CREDITS</span>
                <span class="impact-value" id="creditsWasted">0</span>
            </div>
            <div class="impact-item">
                <span class="impact-label">WAREHOUSE SIZE</span>
                <span class="impact-value">MEDIUM (4cr/hr)</span>
            </div>
            <div class="impact-item">
                <span class="impact-label">DETECTION LAG</span>
                <span class="impact-value" id="avgLagTime">0 hrs</span>
            </div>
        </div>
        
        <!-- COST BREAKDOWN PANEL -->
        <div class="cost-breakdown-panel">
            <div class="breakdown-header">
                ðŸ’° REAL-TIME COST CALCULATION (How we get these numbers)
            </div>
            <div class="breakdown-content">
                <div class="calc-section">
                    <h3>SNOWFLAKE COMPUTE COSTS</h3>
                    <div class="calc-line">
                        <span class="calc-label">Failed Queries:</span>
                        <span class="calc-value"><span id="calcQueries">0</span> queries</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Avg Query Runtime:</span>
                        <span class="calc-value">30 seconds</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Warehouse Cost:</span>
                        <span class="calc-value">$12/hour (Medium)</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Cost per Query:</span>
                        <span class="calc-value">30s Ã· 3600s Ã— $12 = $0.10</span>
                    </div>
                    <div class="calc-line highlight">
                        <span class="calc-label">Query Re-run Cost:</span>
                        <span class="calc-value">$<span id="queryCost">0</span></span>
                    </div>
                </div>
                
                <div class="calc-section">
                    <h3>PIPELINE RECOVERY COSTS</h3>
                    <div class="calc-line">
                        <span class="calc-label">Pipelines Broken:</span>
                        <span class="calc-value"><span id="calcPipelines">0</span> pipelines</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Recovery Time:</span>
                        <span class="calc-value">45 min avg per pipeline</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Engineer Rate:</span>
                        <span class="calc-value">$200/hour (loaded cost)</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Formula:</span>
                        <span class="calc-value">0.75hr Ã— $200 = $150/pipeline</span>
                    </div>
                    <div class="calc-line highlight">
                        <span class="calc-label">Pipeline Recovery:</span>
                        <span class="calc-value">$<span id="pipelineCost">0</span></span>
                    </div>
                </div>
                
                <div class="calc-section">
                    <h3>BUSINESS IMPACT</h3>
                    <div class="calc-line">
                        <span class="calc-label">SLA Penalty:</span>
                        <span class="calc-value">$5,000/hour delayed</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Avg Detection Lag:</span>
                        <span class="calc-value"><span id="avgLag">0</span> hours</span>
                    </div>
                    <div class="calc-line">
                        <span class="calc-label">Formula:</span>
                        <span class="calc-value">Lag Ã— $5,000</span>
                    </div>
                    <div class="calc-line highlight">
                        <span class="calc-label">SLA Cost:</span>
                        <span class="calc-value">$<span id="slaCost">0</span></span>
                    </div>
                </div>
                
                <div class="calc-total">
                    <div class="total-line">
                        <span>QUERY RE-RUN COSTS:</span>
                        <span>$<span id="finalQuery">0</span></span>
                    </div>
                    <div class="total-line">
                        <span>PIPELINE RECOVERY:</span>
                        <span>$<span id="finalPipeline">0</span></span>
                    </div>
                    <div class="total-line">
                        <span>SLA PENALTIES:</span>
                        <span>$<span id="finalSLA">0</span></span>
                    </div>
                    <div class="total-line grand-total">
                        <span>TOTAL VERIFIED COST:</span>
                        <span>$<span id="finalTotal">0</span></span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- MAIN DATA GRID -->
        <div class="drift-main-container">
            <div class="drift-header">
                <div class="drift-title">
                    <div class="mini-logo">FD</div>
                    LIVE DRIFT STREAM
                </div>
                <div class="controls">
                    <button class="ctrl-btn" onclick="toggleTsunamiMode()">ðŸŒŠ TSUNAMI</button>
                    <button class="ctrl-btn" onclick="toggleSound()">ðŸ”Š ALERTS</button>
                    <button class="ctrl-btn" onclick="exportFullData()">ðŸ’¾ EXPORT</button>
                    <div class="live-indicator">
                        <div class="live-pulse"></div>
                        <span>STREAMING</span>
                    </div>
                </div>
            </div>
            
            <div class="scan-line"></div>
            
            <div id="driftContent">
                <div class="loading">
                    <div class="frost-loader"></div>
                    <div>INITIALIZING FROSTDRAGON ENGINE...</div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // DRIFT EVENT GENERATOR - SIMULATED DATA ENGINE
        class DriftEventGenerator {
            constructor() {
                this.databases = ['PROD_DW', 'ANALYTICS_DB', 'STAGING_DB', 'RAW_DATA', 'METRICS_DB'];
                this.schemas = ['PUBLIC', 'FINANCE', 'SALES', 'MARKETING', 'OPS', 'ENGINEERING'];
                this.tables = ['TRANSACTIONS', 'USERS', 'ORDERS', 'EVENTS', 'PRODUCTS', 'METRICS', 'SESSIONS', 'LOGS'];
                this.columns = ['USER_ID', 'TIMESTAMP', 'AMOUNT', 'STATUS', 'CATEGORY', 'JSON_DATA', 'EMAIL', 'PHONE', 'ADDRESS', 'METADATA'];
                this.oldTypes = ['VARCHAR(255)', 'INTEGER', 'DECIMAL(10,2)', 'TIMESTAMP', 'BOOLEAN', 'JSON', 'FLOAT'];
                this.newTypes = ['TEXT', 'BIGINT', 'DOUBLE', 'NULL', 'VARCHAR(500)', 'VARIANT', 'STRING'];
            }
            
            generateEvent() {
                const isCritical = Math.random() < 0.3;
                const severity = isCritical ? 'CRITICAL' : 'HIGH';
                const pipelines = isCritical ? Math.floor(Math.random() * 5) + 1 : Math.floor(Math.random() * 3);
                const queries = Math.floor(Math.random() * 500) + 100;
                const lag = (Math.random() * 4 + 0.5).toFixed(1);
                
                const queryImpact = queries * 0.10;
                const pipelineImpact = pipelines * 150;
                const slaImpact = lag * 5000;
                const totalCost = queryImpact + pipelineImpact + slaImpact;
                
                return {
                    timestamp: new Date().toISOString(),
                    database: this.databases[Math.floor(Math.random() * this.databases.length)],
                    schema: this.schemas[Math.floor(Math.random() * this.schemas.length)],
                    table: `${this.schemas[Math.floor(Math.random() * this.schemas.length)]}.${this.tables[Math.floor(Math.random() * this.tables.length)]}`,
                    column: this.columns[Math.floor(Math.random() * this.columns.length)],
                    old_type: this.oldTypes[Math.floor(Math.random() * this.oldTypes.length)],
                    new_type: this.newTypes[Math.floor(Math.random() * this.newTypes.length)],
                    severity: severity,
                    impact: {
                        pipelines_affected: pipelines,
                        queries_failed: queries,
                        hours_undetected: lag,
                        cost_burned: `$${totalCost.toFixed(2)}`
                    }
                };
            }
            
            generateBatch(count = 10) {
                const events = [];
                for (let i = 0; i < count; i++) {
                    events.push(this.generateEvent());
                }
                return { events };
            }
        }
        
        // STATE MANAGEMENT
        const generator = new DriftEventGenerator();
        let state = {
            totalEvents: 0,
            criticalCount: 0,
            totalCost: 0,
            creditsUsed: 0,
            pipelinesBroken: 0,
            queriesFailed: 0,
            tablesAffected: new Set(),
            soundEnabled: false,
            tsunamiMode: false,
            startTime: Date.now(),
            totalLagHours: 0,
            allEvents: []
        };
        
        // AUDIO ENGINE
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playDriftAlert() {
            if (!state.soundEnabled) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.type = 'sawtooth';
            oscillator.frequency.setValueAtTime(100, audioCtx.currentTime);
            oscillator.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);
            
            gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
            
            oscillator.start(audioCtx.currentTime);
            oscillator.stop(audioCtx.currentTime + 0.5);
        }
        
        // TSUNAMI MODE - VISUAL CASCADE EFFECT
        function createDriftCascade(cost) {
            if (!state.tsunamiMode) return;
            
            const cascade = document.createElement('div');
            cascade.className = 'drift-cascade';
            cascade.textContent = cost;
            cascade.style.left = Math.random() * window.innerWidth + 'px';
            document.body.appendChild(cascade);
            
            setTimeout(() => cascade.remove(), 3000);
        }
        
        // MATRIX RAIN ANIMATION
        function initMatrix() {
            const canvas = document.getElementById('matrixCanvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            const matrix = "FROSTDRAGON01";
            const matrixArray = matrix.split("");
            const fontSize = 10;
            const columns = canvas.width / fontSize;
            const drops = [];
            
            for(let x = 0; x < columns; x++) {
                drops[x] = Math.random() * -100;
            }
            
            function draw() {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = '#00ffff';
                ctx.font = fontSize + 'px monospace';
                
                for(let i = 0; i < drops.length; i++) {
                    const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    
                    if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                        drops[i] = 0;
                    }
                    drops[i]++;
                }
            }
            
            setInterval(draw, 35);
        }
        
        // DATA PROCESSING WITH TSUNAMI EFFECT
        function processDriftData() {
            const data = generator.generateBatch(state.tsunamiMode ? 15 : 5);
            const events = data.events;
            
            events.forEach((event, index) => {
                setTimeout(() => {
                    // Add animation class temporarily
                    document.body.classList.add('tsunami-active');
                    setTimeout(() => document.body.classList.remove('tsunami-active'), 500);
                    
                    // Update counters
                    state.totalEvents++;
                    if (event.severity === 'CRITICAL') {
                        state.criticalCount++;
                        playDriftAlert();
                    }
                    
                    // Update metrics
                    state.pipelinesBroken += event.impact.pipelines_affected;
                    state.queriesFailed += event.impact.queries_failed;
                    state.tablesAffected.add(event.table);
                    state.totalLagHours += parseFloat(event.impact.hours_undetected);
                    state.creditsUsed += parseFloat(event.impact.hours_undetected) * 4;
                    
                    // Add to events list
                    state.allEvents.unshift(event);
                    if (state.allEvents.length > 50) {
                        state.allEvents = state.allEvents.slice(0, 50);
                    }
                    
                    // Create cascade effect for critical events
                    if (event.severity === 'CRITICAL') {
                        createDriftCascade(event.impact.cost_burned);
                    }
                    
                    updateMetrics();
                    renderDriftTable();
                }, index * (state.tsunamiMode ? 200 : 500));
            });
        }
        
        // UPDATE METRICS DISPLAY
        function updateMetrics() {
            const queryCost = state.queriesFailed * 0.10;
            const pipelineCost = state.pipelinesBroken * 150;
            const slaCost = state.totalLagHours * 5000;
            const totalCost = queryCost + pipelineCost + slaCost;
            const avgLag = state.totalEvents > 0 ? state.totalLagHours / state.totalEvents : 0;
            const avgCostPerEvent = state.totalEvents > 0 ? totalCost / state.totalEvents : 0;
            
            // Update all displays
            document.getElementById('totalCost').textContent = `$${totalCost.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
            document.getElementById('driftCount').textContent = state.totalEvents;
            document.getElementById('avgCost').textContent = `$${avgCostPerEvent.toFixed(0)}`;
            document.getElementById('pipelinesBroken').textContent = state.pipelinesBroken;
            document.getElementById('queriesFailed').textContent = state.queriesFailed.toLocaleString();
            document.getElementById('tablesAffected').textContent = state.tablesAffected.size;
            document.getElementById('creditsWasted').textContent = Math.floor(state.creditsUsed);
            document.getElementById('avgLagTime').textContent = `${avgLag.toFixed(1)} hrs`;
            
            // Update breakdown
            document.getElementById('calcQueries').textContent = state.queriesFailed.toLocaleString();
            document.getElementById('queryCost').textContent = queryCost.toFixed(2);
            document.getElementById('calcPipelines').textContent = state.pipelinesBroken;
            document.getElementById('pipelineCost').textContent = pipelineCost.toFixed(2);
            document.getElementById('avgLag').textContent = avgLag.toFixed(1);
            document.getElementById('slaCost').textContent = slaCost.toFixed(2);
            document.getElementById('finalQuery').textContent = queryCost.toFixed(2);
            document.getElementById('finalPipeline').textContent = pipelineCost.toFixed(2);
            document.getElementById('finalSLA').textContent = slaCost.toFixed(2);
            document.getElementById('finalTotal').textContent = totalCost.toFixed(2);
        }
        
        // RENDER DRIFT TABLE
        function renderDriftTable() {
            const eventsToShow = state.allEvents.slice(0, 15);
            
            const tableHTML = `
                <table class="drift-table">
                    <thead>
                        <tr>
                            <th>TIMESTAMP</th>
                            <th>DATABASE.TABLE</th>
                            <th>COLUMN</th>
                            <th>MUTATION</th>
                            <th>SEVERITY</th>
                            <th>COST IMPACT</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${eventsToShow.map((event, idx) => `
                            <tr class="drift-row ${idx === 0 ? 'new-entry' : ''}" data-severity="${event.severity}">
                                <td class="timestamp">${new Date(event.timestamp).toTimeString().split(' ')[0]}</td>
                                <td class="table-name">${event.table}</td>
                                <td class="column-name">${event.column}</td>
                                <td class="mutation">
                                    <span class="old-schema">${event.old_type}</span>
                                    <span class="arrow">â†’</span>
                                    <span class="new-schema ${event.new_type === 'NULL' ? 'dropped' : ''}">${event.new_type}</span>
                                </td>
                                <td>
                                    <span class="severity-badge severity-${event.severity.toLowerCase()}">
                                        ${event.severity}
                                    </span>
                                </td>
                                <td class="cost">${event.impact.cost_burned}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
                
                <div class="technical-footer">
                    <span>POD: snowdragon-56f9d9dbd8</span>
                    <span>|</span>
                    <span>SERVICE: snowdragon-api</span>
                    <span>|</span>
                    <span>EVENTS: ${state.totalEvents}</span>
                    <span>|</span>
                    <span>MODE: ${state.tsunamiMode ? 'TSUNAMI' : 'NORMAL'}</span>
                </div>
            `;
            
            document.getElementById('driftContent').innerHTML = tableHTML;
        }
        
        // CONTROL FUNCTIONS
        function toggleSound() {
            state.soundEnabled = !state.soundEnabled;
            document.querySelectorAll('.ctrl-btn')[1].textContent = state.soundEnabled ? 'ðŸ”” ALERTS' : 'ðŸ”Š ALERTS';
        }
        
        function toggleTsunamiMode() {
            state.tsunamiMode = !state.tsunamiMode;
            document.querySelectorAll('.ctrl-btn')[0].textContent = state.tsunamiMode ? 'ðŸ’¥ TSUNAMI!' : 'ðŸŒŠ TSUNAMI';
        }
        
        function exportFullData() {
            const timestamp = new Date().toISOString();
            const exportData = {
                timestamp: timestamp,
                engine: 'FROSTDRAGON v5.0.0',
                metrics: {
                    total_events: state.totalEvents,
                    critical_events: state.criticalCount,
                    pipelines_broken: state.pipelinesBroken,
                    queries_failed: state.queriesFailed,
                    tables_affected: Array.from(state.tablesAffected)
                },
                recent_events: state.allEvents.slice(0, 10)
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `frostdragon_drift_${timestamp}.json`;
            a.click();
        }
        
        // UPDATE CLOCK
        function updateClock() {
            document.getElementById('timestamp').textContent = new Date().toTimeString().split(' ')[0];
        }
        
        // INITIALIZATION
        document.addEventListener('DOMContentLoaded', () => {
            initMatrix();
            
            // Start with initial data after 1 second
            setTimeout(() => {
                processDriftData();
                setInterval(processDriftData, 5000);
            }, 1000);
            
            setInterval(updateClock, 1000);
        });
    </script>
</body>
</html>
